<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Kalimati:wght@400;700&display=swap" rel="stylesheet">
    <title>खडक नगरपालिका - कर्मचारी व्यवस्थापन प्रणाली</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Kalimati', 'Mangal', 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo img {
            height: 60px;
            width: 60px;
            background: white;
            padding: 5px;
            border-radius: 50%;
        }
        
        .header-text h1 {
            font-size: 22px;
            margin-bottom: 5px;
        }
        
        .header-text h2 {
            font-size: 16px;
            font-weight: normal;
            color: #ecf0f1;
        }
        
        .login-info {
            text-align: right;
            font-size: 14px;
        }
        
        /* Navigation Styles */
        .navbar {
            background-color: #2980b9;
            padding: 0 20px;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-links li {
            padding: 0;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            display: block;
            transition: background 0.3s;
            font-size: 15px;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background-color: #1a5276;
        }
        
        /* Main Content Styles */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .card .count {
            font-size: 32px;
            font-weight: bold;
            color: #3498db;
        }
        
        .section-title {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        /* Form Styles */
        .form-container {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: bold;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-control:focus {
            border-color: #3498db;
            outline: none;
        }
        
        /* Button Styles */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #219653;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d68910;
        }
        
        /* Table Styles */
        .table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background-color: #3498db;
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        /* Login Styles */
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        
        .login-title {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 24px;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        /* Footer Styles */
        .footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
            }
            
            .nav-links {
                flex-wrap: wrap;
            }
            
            .nav-links a {
                padding: 10px 15px;
            }
            
            .header-container {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .login-info {
                text-align: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="bs-converter.js"></script>
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <img src="https://via.placeholder.com/60/ffffff/3498db?text=KNP" alt="Logo">
                <div class="header-text">
                    <h1>खडक नगरपालिका, सप्तरी</h1>
                    <h2>कर्मचारी व्यवस्थापन प्रणाली</h2>
                </div>
            </div>
            <div class="login-info">
                <div id="userInfo">प्रवेश गर्नुहोस्</div>
                <button onclick="showLoginModal()" class="btn btn-primary" style="margin-top: 5px;">
                    <i class="fas fa-sign-in-alt"></i> लगइन
                </button>
            </div>
        </div>
    </header>
    
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="#" class="active" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> ड्यासबोर्ड</a></li>
                <li><a href="employee_data_input.html"><i class="fas fa-keyboard"></i> डाटा इनपुट</a></li>
                <li><a href="#" onclick="showSection('addEmployee')"><i class="fas fa-user-plus"></i> नयाँ कर्मचारी</a></li>
                <li><a href="#" onclick="showSection('viewEmployees')"><i class="fas fa-users"></i> सबै कर्मचारी</a></li>
                <li><a href="employee_management.html"><i class="fas fa-users-cog"></i> व्यवस्थापन</a></li>
                <li><a href="employee_details_report.html"><i class="fas fa-file-pdf"></i> रिपोर्ट</a></li>
                <li><a href="biodata.html"><i class="fas fa-id-card"></i> बायोडाटा</a></li>
                <li><a href="darwandi_form.html"><i class="fas fa-file-alt"></i> दरवन्दी</a></li>
                <li><a href="#" onclick="showSection('reports')"><i class="fas fa-chart-bar"></i> रिपोर्टहरू</a></li>
                <li><a href="#" onclick="showSection('adminPanel')" id="adminLink" style="display:none;"><i class="fas fa-cog"></i> एडमिन</a></li>
            </ul>
        </div>
    </nav>
    
    <!-- Main Content Container -->
    <div class="container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section">
            <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> ड्यासबोर्ड</h2>
            <div class="dashboard-cards">
                <div class="card">
                    <h3>कुल कर्मचारी</h3>
                    <div class="count" id="totalEmployees">0</div>
                </div>
                <div class="card">
                    <h3>निजामती कर्मचारी</h3>
                    <div class="count" id="nijamatiEmployees">0</div>
                </div>
                <div class="card">
                    <h3>स्थानीय तह कर्मचारी</h3>
                    <div class="count" id="localEmployees">0</div>
                </div>
                <div class="card">
                    <h3>करार कर्मचारी</h3>
                    <div class="count" id="contractEmployees">0</div>
                </div>
            </div>
            
            <h3 class="section-title"><i class="fas fa-history"></i> भर्खर थपिएका कर्मचारी</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>क्र.सं.</th>
                            <th>नाम</th>
                            <th>पद</th>
                            <th>कर्मचारी प्रकार</th>
                            <th>शाखा</th>
                            <th>सम्पर्क नम्बर</th>
                            <th>नियुक्ति मिति</th>
                            <th>कार्य</th>
                        </tr>
                    </thead>
                    <tbody id="recentEmployeesTable">
                        <!-- Recent employees will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Add Employee Section -->
        <section id="addEmployee" class="content-section" style="display:none;">
            <h2 class="section-title"><i class="fas fa-user-plus"></i> नयाँ कर्मचारी दर्ता गर्नुहोस्</h2>
            
            <!-- निर्देशन खण्ड -->
            <div style="background: #e8f4f8; border-left: 4px solid #3498db; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
                <h4 style="margin-top: 0; color: #2c3e50;"><i class="fas fa-info-circle"></i> निर्देशनहरू:</h4>
                <ul style="margin: 10px 0; padding-left: 20px; color: #34495e; line-height: 1.6;">
                    <li><strong>व्यक्तिगत विवरण:</strong> कर्मचारी संकेत नम्बर (जस्तै EMP-0001), पूरा नाम, जन्म मिति, पिताको नाम, पद, तह (क/ख/ग), सेवा समूह, र विशेष पद भर्नुहोस्।</li>
                    <li><strong>शैक्षिक योग्यता:</strong> शिक्षागत योग्यता, विशेषज्ञता, अनुभव (वर्षहरूमा), र प्रशिक्षण पूरा भएको हो कि होइन भर्नुहोस्।</li>
                    <li><strong>सम्पर्क विवरण:</strong> फोन नम्बर (अनिवार्य), वैकल्पिक नम्बर, इमेल, स्थायी ठेगाना, आपतकालीन सम्पर्क व्यक्तिको नाम र नम्बर भर्नुहोस्।</li>
                    <li><strong>नियुक्ति विवरण:</strong> नियुक्ति मिति (Gregorian, BS मा सुरक्षित), नियुक्ति आदेश नम्बर, मासिक तलब, भत्ता, हालको अवस्था, र सेवा पूरा गरेको मिति भर्नुहोस्।</li>
                    <li><strong>पहिचान विवरण:</strong> नागरिकता नम्बर, पासपोर्ट नम्बर, PAN, र बैंक खाता नम्बर भर्नुहोस्।</li>
                    <li><strong>फोटो:</strong> JPG वा PNG फर्म्याटमा कर्मचारीको फोटो अपलोड गर्नुहोस् वा फोटोको URL दिनुहोस्।</li>
                    <li><strong>दस्तावेज:</strong> नियुक्ति, समायोजन, बढुवा, र काज सम्बन्धित मिति र दस्तावेज (फोटो/PDF) अपलोड गर्नुहोस्। मिति बिक्रम संवत्मा सुरक्षित हुनेछ।</li>
                    <li><i class="fas fa-star" style="color: #e74c3c;"></i> <strong>लाल तारा (*) भएका फिल्ड अनिवार्य छन्।</strong></li>
                </ul>
            </div>

            <div class="form-container">
                <form id="employeeForm">
                    <!-- व्यक्तिगत विवरण -->
                    <h3 style="color:#2c3e50; border-bottom:1px solid #ddd; padding-bottom:8px; margin-bottom:12px;">व्यक्तिगत विवरण</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="employeeId">कर्मचारी संकेत नम्बर <span style="color:red;">*</span></label>
                            <input type="text" id="employeeId" class="form-control" required placeholder="जस्तै: EMP-0001">
                        </div>
                        <div class="form-group">
                            <label for="fullName">पूरा नाम <span style="color:red;">*</span></label>
                            <input type="text" id="fullName" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="dateOfBirth">जन्म मिति (BS मा सुरक्षित हुनेछ)</label>
                            <input type="date" id="dateOfBirth" class="form-control">
                            <small style="color:#7f8c8d;">Gregorian मिति छान्नुहोस्</small>
                        </div>
                        <div class="form-group">
                            <label for="fatherName">बाबुको नाम</label>
                            <input type="text" id="fatherName" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="position">पद/जागिर <span style="color:red;">*</span></label>
                            <input type="text" id="position" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="serviceLevel">तह (Level/Grade)</label>
                            <select id="serviceLevel" class="form-control">
                                <option value="">चयन गर्नुहोस्</option>
                                <option value="प्र.क">प्र.क (Principal)</option>
                                <option value="उ.क">उ.क (Senior)</option>
                                <option value="म.क">म.क (Junior)</option>
                                <option value="अन्य">अन्य</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="serviceGroup">सेवा समूह</label>
                            <select id="serviceGroup" class="form-control">
                                <option value="">चयन गर्नुहोस्</option>
                                <option value="क">क (क्षेत्र समूह)</option>
                                <option value="ख">ख (ख समूह)</option>
                                <option value="ग">ग (ग समूह)</option>
                                <option value="घ">घ (घ समूह)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="subGroup">उपसमूह</label>
                            <input type="text" id="subGroup" class="form-control" placeholder="जस्तै: १, २, ३...">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="employeeType">कर्मचारी प्रकार <span style="color:red;">*</span></label>
                            <select id="employeeType" class="form-control" required>
                                <option value="">चयन गर्नुहोस्</option>
                                <option value="निजामती">निजामती</option>
                                <option value="स्थानीय तह">स्थानीय तह</option>
                                <option value="करार">करार</option>
                                <option value="अन्य">अन्य</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="department">शाखा/विभाग</label>
                            <input type="text" id="department" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="designation">बिशेष पद/Designation</label>
                            <input type="text" id="designation" class="form-control" placeholder="जस्तै: प्रमुख, सदस्य...">
                        </div>
                    </div>
                    
                    <!-- सम्पर्क विवरण -->
                    <h3 style="color:#2c3e50; border-bottom:1px solid #ddd; padding-bottom:8px; margin-top:16px; margin-bottom:12px;">शैक्षिक योग्यता र अनुभव</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="qualification">शैक्षिक योग्यता (Qualification)</label>
                            <input type="text" id="qualification" class="form-control" placeholder="जस्तै: BA, MA, BCA...">
                        </div>
                        <div class="form-group">
                            <label for="specialization">विशेषज्ञता (Specialization)</label>
                            <input type="text" id="specialization" class="form-control">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="experienceYears">अनुभव (वर्षहरूमा)</label>
                            <input type="number" id="experienceYears" class="form-control" min="0">
                        </div>
                        <div class="form-group">
                            <label for="trainingCompleted">प्रशिक्षण पूरा गरिएको</label>
                            <select id="trainingCompleted" class="form-control">
                                <option value="होइन">होइन</option>
                                <option value="हो">हो</option>
                            </select>
                        </div>
                    </div>

                    <!-- सम्पर्क विवरण -->
                    <h3 style="color:#2c3e50; border-bottom:1px solid #ddd; padding-bottom:8px; margin-top:16px; margin-bottom:12px;">सम्पर्क विवरण</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone">सम्पर्क नम्बर <span style="color:red;">*</span></label>
                            <input type="text" id="phone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="alternatePhone">वैकल्पिक सम्पर्क नम्बर</label>
                            <input type="text" id="alternatePhone" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">इमेल ठेगाना</label>
                            <input type="email" id="email" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="address">स्थायी ठेगाना</label>
                            <input type="text" id="address" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="emergencyContact">आपतकालीन सम्पर्क व्यक्तिको नाम</label>
                            <input type="text" id="emergencyContact" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="emergencyPhone">आपतकालीन सम्पर्क नम्बर</label>
                            <input type="text" id="emergencyPhone" class="form-control">
                        </div>
                    </div>

                    <!-- नियुक्ति विवरण -->
                    <h3 style="color:#2c3e50; border-bottom:1px solid #ddd; padding-bottom:8px; margin-top:16px; margin-bottom:12px;">नियुक्ति विवरण</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="joinDate">नियुक्ति मिति (आज बिक्रम संवत्मा देखिन्छ)</label>
                            <input type="date" id="joinDate" class="form-control">
                            <small style="color:#7f8c8d;">Gregorian मिति छान्नुहोस्, यो BS मा सुरक्षित हुनेछ</small>
                        </div>
                        <div class="form-group">
                            <label for="joiningOrder">नियुक्ति आदेश नम्बर</label>
                            <input type="text" id="joiningOrder" class="form-control" placeholder="जस्तै: २०२०/०१/१०">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="salary">मासिक तलब (रु. मा)</label>
                            <input type="number" id="salary" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="allowance">भत्ता (रु. मा)</label>
                            <input type="number" id="allowance" class="form-control">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="status">हालको अवस्था</label>
                            <select id="status" class="form-control">
                                <option value="सक्रिय">सक्रिय</option>
                                <option value="निष्क्रिय">निष्क्रिय</option>
                                <option value="अवकाश">अवकाश</option>
                                <option value="सेवामुक्त">सेवामुक्त</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="serviceComplete">सेवा पूरा गरेको मिति</label>
                            <input type="date" id="serviceComplete" class="form-control">
                        </div>
                    </div>

                    <!-- पहिचान र नागरिकता विवरण -->
                    <h3 style="color:#2c3e50; border-bottom:1px solid #ddd; padding-bottom:8px; margin-top:16px; margin-bottom:12px;">पहिचान र नागरिकता विवरण</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nationalId">नागरिकता/न.प्र. नम्बर</label>
                            <input type="text" id="nationalId" class="form-control" placeholder="जस्तै: १२३४५६७८९०">
                        </div>
                        <div class="form-group">
                            <label for="passportNumber">पासपोर्ट नम्बर (यदि छ भने)</label>
                            <input type="text" id="passportNumber" class="form-control">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="panNumber">PAN नम्बर</label>
                            <input type="text" id="panNumber" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="bankAccount">बैंक खाता नम्बर</label>
                            <input type="text" id="bankAccount" class="form-control">
                        </div>
                    </div>

                    <!-- फोटो र थप जानकारी -->
                    <h3 style="color:#2c3e50; border-bottom:1px solid #ddd; padding-bottom:8px; margin-top:16px; margin-bottom:12px;">फोटो र अतिरिक्त जानकारी</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="photoFile">कर्मचारी फोटो</label>
                            <input type="file" id="photoFile" class="form-control" accept="image/*">
                            <small style="color:#7f8c8d;">JPG, PNG आदि अपलोड गर्न सकिन्छ</small>
                        </div>
                        <div class="form-group">
                            <label for="photoURL">वा फोटो URL (वैकल्पिक)</label>
                            <input type="text" id="photoURL" class="form-control" placeholder="https://...">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="grid-column:1/-1;">
                            <label for="extraInfo">थप जानकारी / नोट्स</label>
                            <input type="text" id="extraInfo" class="form-control">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="grid-column:1/-1;">
                            <label for="remarks">टिप्पणीहरू</label>
                            <textarea id="remarks" class="form-control" rows="3"></textarea>
                        </div>
                    </div>

                    <!-- दस्तावेज र सम्बन्धित मिति -->
                    <h3 style="color:#2c3e50; border-bottom:1px solid #ddd; padding-bottom:8px; margin-top:16px; margin-bottom:12px;">दस्तावेज र सम्बन्धित मिति (बिक्रम संवत्मा सुरक्षित हुनेछ)</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="appointmentDocDate">नियुक्ति मिति</label>
                            <input type="date" id="appointmentDocDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="appointmentDoc">नियुक्ति दस्तावेज (फोटो/पिडिएफ)</label>
                            <input type="file" id="appointmentDoc" class="form-control" accept="image/*,.pdf">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="adjustmentDate">समायोजन मिति</label>
                            <input type="date" id="adjustmentDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="adjustmentDoc">समायोजन दस्तावेज (फोटो/पिडिएफ)</label>
                            <input type="file" id="adjustmentDoc" class="form-control" accept="image/*,.pdf">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="promotionDate">बढुवा मिति</label>
                            <input type="date" id="promotionDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="promotionDoc">बढुवा दस्तावेज (फोटो/पिडिएफ)</label>
                            <input type="file" id="promotionDoc" class="form-control" accept="image/*,.pdf">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="deputationDate">काज/समायोजन गरिएको मिति</label>
                            <input type="date" id="deputationDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="deputationDoc">काज दस्तावेज (फोटो/पिडिएफ)</label>
                            <input type="file" id="deputationDoc" class="form-control" accept="image/*,.pdf">
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 2px solid #ecf0f1;">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> कर्मचारी दर्ता गर्नुहोस्</button>
                        <button type="button" onclick="resetForm()" class="btn btn-warning" style="margin-left:10px;"><i class="fas fa-redo"></i> रिसेट गर्नुहोस्</button>
                    </div>
                </form>
            </div>
        </section>
        
        <!-- View Employees Section -->
        <section id="viewEmployees" class="content-section" style="display:none;">
            <h2 class="section-title"><i class="fas fa-users"></i> सबै कर्मचारीहरू</h2>
            
            <div class="form-container" style="margin-bottom: 20px;">
                <div class="form-row">
                    <div class="form-group">
                        <label for="searchEmployee">कर्मचारी खोज्नुहोस्</label>
                        <input type="text" id="searchEmployee" class="form-control" placeholder="नाम, पद, वा शाखा द्वारा खोज्नुहोस्" onkeyup="searchEmployees()">
                    </div>
                    <div class="form-group">
                        <label for="filterType">कर्मचारी प्रकार छान्नुहोस्</label>
                        <select id="filterType" class="form-control" onchange="filterEmployees()">
                            <option value="सबै">सबै</option>
                            <option value="निजामती">निजामती</option>
                            <option value="स्थानीय तह">स्थानीय तह</option>
                            <option value="करार">करार</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>क्र.सं.</th>
                            <th>नाम</th>
                            <th>पद</th>
                            <th>कर्मचारी प्रकार</th>
                            <th>शाखा</th>
                            <th>सम्पर्क</th>
                            <th>अवस्था</th>
                            <th>कार्य</th>
                        </tr>
                    </thead>
                    <tbody id="employeesTable">
                        <!-- Employees will be loaded here -->
                    </tbody>
                </table>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="printEmployeeReport()" class="btn btn-success"><i class="fas fa-print"></i> रिपोर्ट प्रिन्ट गर्नुहोस्</button>
                <button onclick="exportToExcel()" class="btn btn-success"><i class="fas fa-file-excel"></i> एक्सेलमा निर्यात गर्नुहोस्</button>
            </div>
        </section>
        
        <!-- Reports Section -->
        <section id="reports" class="content-section" style="display:none;">
            <h2 class="section-title"><i class="fas fa-chart-bar"></i> रिपोर्टहरू</h2>
            
            <div class="dashboard-cards">
                <div class="card" onclick="generateReport('type')" style="cursor:pointer;">
                    <h3><i class="fas fa-chart-pie"></i> कर्मचारी प्रकार अनुसार</h3>
                    <div id="typeChart" style="height: 200px;"></div>
                </div>
                <div class="card" onclick="generateReport('department')" style="cursor:pointer;">
                    <h3><i class="fas fa-chart-bar"></i> शाखा अनुसार</h3>
                    <div id="departmentChart" style="height: 200px;"></div>
                </div>
                <div class="card" onclick="generateReport('status')" style="cursor:pointer;">
                    <h3><i class="fas fa-chart-line"></i> अवस्था अनुसार</h3>
                    <div id="statusChart" style="height: 200px;"></div>
                </div>
            </div>
            
            <div class="form-container">
                <h3 style="margin-bottom: 15px;">विस्तृत रिपोर्ट जेनरेटर</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="reportType">रिपोर्ट प्रकार</label>
                        <select id="reportType" class="form-control">
                            <option value="summary">सारांश रिपोर्ट</option>
                            <option value="detailed">विस्तृत रिपोर्ट</option>
                            <option value="salary">तलब रिपोर्ट</option>
                            <option value="contract">करार कर्मचारी रिपोर्ट</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reportFormat">फर्म्याट</label>
                        <select id="reportFormat" class="form-control">
                            <option value="table">टेबुलर</option>
                            <option value="pdf">PDF</option>
                            <option value="excel">एक्सेल</option>
                        </select>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button onclick="generateDetailedReport()" class="btn btn-primary"><i class="fas fa-cogs"></i> रिपोर्ट जेनरेट गर्नुहोस्</button>
                </div>
            </div>
            
            <div id="reportResult" class="table-container" style="display:none; margin-top: 20px;">
                <h3 id="reportTitle" style="padding: 15px; border-bottom: 1px solid #eee;"></h3>
                <div id="reportContent" style="padding: 15px;">
                    <!-- Report content will be loaded here -->
                </div>
            </div>
        </section>
        
        <!-- Admin Panel Section -->
        <section id="adminPanel" class="content-section" style="display:none;">
            <h2 class="section-title"><i class="fas fa-cog"></i> एडमिन प्यानल</h2>
            
            <div class="dashboard-cards">
                <div class="card" onclick="showAdminSection('userManagement')" style="cursor:pointer;">
                    <h3><i class="fas fa-user-cog"></i> प्रयोगकर्ता व्यवस्थापन</h3>
                    <p>प्रयोगकर्ता थप्न, हटाउन र सच्याउन</p>
                </div>
                <div class="card" onclick="showAdminSection('dataBackup')" style="cursor:pointer;">
                    <h3><i class="fas fa-database"></i> डाटा ब्याकअप</h3>
                    <p>डाटा ब्याकअप र रिस्टोर गर्न</p>
                </div>
                <div class="card" onclick="showAdminSection('systemLogs')" style="cursor:pointer;">
                    <h3><i class="fas fa-history"></i> सिस्टम लगहरू</h3>
                    <p>सिस्टम गतिविधि हेर्न</p>
                </div>
                <div class="card" onclick="showAdminSection('settings')" style="cursor:pointer;">
                    <h3><i class="fas fa-sliders-h"></i> सिस्टम सेटिङ</h3>
                    <p>सिस्टम सेटिङ परिवर्तन गर्न</p>
                </div>
                <div class="card" onclick="showAdminSection('sampleData')" style="cursor:pointer; background: #fff3cd; border-left: 4px solid #ffc107;">
                    <h3><i class="fas fa-flask"></i> नमूना डाटा</h3>
                    <p>परीक्षणको लागि ६० कर्मचारी जोड्न</p>
                </div>
            </div>
            
            <!-- User Management Section -->
            <div id="userManagementSection" class="form-container" style="display:none; margin-top: 20px;">
                <h3><i class="fas fa-user-cog"></i> प्रयोगकर्ता व्यवस्थापन</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="newUsername">नयाँ प्रयोगकर्ता नाम</label>
                        <input type="text" id="newUsername" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">पासवर्ड</label>
                        <input type="password" id="newPassword" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="userRole">भूमिका</label>
                        <select id="userRole" class="form-control">
                            <option value="user">साधारण प्रयोगकर्ता</option>
                            <option value="admin">एडमिन</option>
                            <option value="viewer">दर्शक</option>
                        </select>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button onclick="addNewUser()" class="btn btn-success"><i class="fas fa-user-plus"></i> प्रयोगकर्ता थप्नुहोस्</button>
                </div>
                
                <h4 style="margin-top: 25px; border-bottom: 1px solid #eee; padding-bottom: 10px;">वर्तमान प्रयोगकर्ताहरू</h4>
                <div class="table-container" style="margin-top: 15px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>प्रयोगकर्ता नाम</th>
                                <th>भूमिका</th>
                                <th>अन्तिम लगइन</th>
                                <th>कार्य</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Sample Data Section -->
            <div id="sampleDataSection" class="form-container" style="display:none; margin-top: 20px;">
                <h3><i class="fas fa-flask"></i> नमूना डाटा - परीक्षणको लागि</h3>
                
                <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
                    <h4 style="margin-top: 0; color: #856404;">⚠️ सावधानी:</h4>
                    <p style="color: #856404; margin-bottom: 0;">यो नमूना डाटा परीक्षणको लागि मात्र हो। कृपया उत्पादन वातावरणमा ব्यবहार गर्नुहोस्।</p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 4px; border-left: 4px solid #4caf50;">
                        <h4 style="margin-top: 0; color: #2e7d32;"><i class="fas fa-plus-circle"></i> नयाँ डाटा थप्नुहोस्</h4>
                        <p style="color: #558b2f; margin-bottom: 15px;">६० जना कर्मचारीको नमूना डाटा भण्डारमा थप्नुहोस्। यो परीक्षण र विकासको लागि उपयोगी छ।</p>
                        <button onclick="generateSampleEmployees()" class="btn btn-success" style="width: 100%;">
                            <i class="fas fa-database"></i> नमूना डाटा थप्नुहोस्
                        </button>
                    </div>

                    <div style="background: #ffebee; padding: 15px; border-radius: 4px; border-left: 4px solid #f44336;">
                        <h4 style="margin-top: 0; color: #c62828;"><i class="fas fa-trash-alt"></i> डाटा मेटाउनुहोस्</h4>
                        <p style="color: #d32f2f; margin-bottom: 15px;">सबै कर्मचारीको डाटा स्थायी रूपमा मेटाउनुहोस्। यो क्रिया उल्टाउन सकिँदैन।</p>
                        <button onclick="clearAllEmployees()" class="btn btn-danger" style="width: 100%;">
                            <i class="fas fa-trash"></i> सबै डाटा मेटाउनुहोस्
                        </button>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 4px;">
                    <h4 style="margin-top: 0;">सांख्यिकी:</h4>
                    <p>कुल कर्मचारी: <strong id="totalEmployeeCount">-</strong></p>
                    <p>कुल दरवन्दी: <strong id="totalDarwandiCount">-</strong></p>
                    <button onclick="updateStatistics()" class="btn btn-info">
                        <i class="fas fa-sync"></i> सांख्यिकी अपडेट गर्नुहोस्
                    </button>
                </div>
            </div>
            
            <!-- Other admin sections would be added here -->
        </section>
    </div>
    
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeLoginModal()">&times;</span>
            <h2 class="login-title"><i class="fas fa-sign-in-alt"></i> प्रणालीमा प्रवेश गर्नुहोस्</h2>
            
            <div class="form-group">
                <label for="loginUsername">प्रयोगकर्ता नाम</label>
                <input type="text" id="loginUsername" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="loginPassword">पासवर्ड</label>
                <input type="password" id="loginPassword" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="loginType">लगइन प्रकार</label>
                <select id="loginType" class="form-control">
                    <option value="superadmin">सुपर एडमिन</option>
                    <option value="admin">एडमिन</option>
                    <option value="user">साधारण प्रयोगकर्ता</option>
                </select>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="login()" class="btn btn-primary" style="width: 100%;"><i class="fas fa-sign-in-alt"></i> लगइन गर्नुहोस्</button>
            </div>
            
            <div id="loginMessage" style="margin-top: 15px; text-align: center; color: red;"></div>
        </div>
    </div>
    
    <!-- Employee Detail Modal -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEmployeeModal()">&times;</span>
            <h2 id="modalTitle" class="login-title">कर्मचारी विवरण</h2>
            <div id="employeeDetails" style="margin-top: 20px;">
                <!-- Employee details will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <p>© २०८१ खडक नगरपालिका, सप्तरी | सबै अधिकार सुरक्षित</p>
        <p>यो प्रणाली खडक नगरपालिकाको संगठन र व्यवस्थापन सर्वेक्षणको लागि विकास गरिएको हो</p>
        <p style="font-size: 12px; margin-top: 10px;">संस्करण १.० | अन्तिम अपडेट: २०८१/०१/१५</p>
    </footer>
    
    <script>
        // Database simulation using localStorage
        const DB_NAME = "khadak_municipality_db";
        const SUPER_ADMIN_PASS = "abcd@1";
        const ADMIN_PASS = "abc123";
        
        // Initialize the database
        function initializeDatabase() {
            if (!localStorage.getItem(DB_NAME)) {
                const initialData = {
                    employees: [
                        {
                            id: 1,
                            fullName: "राम बहादुर श्रेष्ठ",
                            position: "प्रशासकिय अधिकृत",
                            employeeType: "निजामती",
                            department: "प्रशासन",
                            phone: "९८०१२३४५६७",
                            email: "ram@khadakmun.gov.np",
                            address: "वडा नं. १, खडक",
                            joinDate: "२०७५-०१-१५",
                            salary: 75000,
                            status: "सक्रिय",
                            remarks: "",
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 2,
                            fullName: "सीता कुमारी महतो",
                            position: "सामाजिक विकास अधिकृत",
                            employeeType: "स्थानीय तह",
                            department: "सामाजिक विकास",
                            phone: "९८१२३४५६७८",
                            email: "sita@khadakmun.gov.np",
                            address: "वडा नं. ३, खडक",
                            joinDate: "२०७८-०५-२०",
                            salary: 65000,
                            status: "सक्रिय",
                            remarks: "",
                            createdAt: new Date().toISOString()
                        }
                    ],
                    users: [
                        {username: "superadmin", password: SUPER_ADMIN_PASS, role: "superadmin", lastLogin: ""},
                        {username: "admin", password: ADMIN_PASS, role: "admin", lastLogin: ""}
                    ],
                    systemLogs: []
                };
                localStorage.setItem(DB_NAME, JSON.stringify(initialData));
            }
            updateDashboard();
            loadEmployees();
            loadRecentEmployees();
        }
        
        // Helper: read file input as DataURL (returns Promise)
        function readFileAsDataURL(input) {
            return new Promise((resolve) => {
                if (!input || !input.files || input.files.length === 0) return resolve(null);
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = () => resolve(null);
                reader.readAsDataURL(file);
            });
        }

        // Upload selected files to server via upload.php
        async function uploadSelectedFiles() {
            const fd = new FormData();
            const appointment = document.getElementById('appointmentDoc');
            const adjustment = document.getElementById('adjustmentDoc');
            const promotion = document.getElementById('promotionDoc');
            const deputation = document.getElementById('deputationDoc');
            const photoFile = document.getElementById('photoFile');

            if (appointment && appointment.files && appointment.files[0]) fd.append('appointmentDoc', appointment.files[0]);
            if (adjustment && adjustment.files && adjustment.files[0]) fd.append('adjustmentDoc', adjustment.files[0]);
            if (promotion && promotion.files && promotion.files[0]) fd.append('promotionDoc', promotion.files[0]);
            if (deputation && deputation.files && deputation.files[0]) fd.append('deputationDoc', deputation.files[0]);
            if (photoFile && photoFile.files && photoFile.files[0]) fd.append('photoFile', photoFile.files[0]);

            // if no files, return empty mapping
            if (fd.keys && !fd.keys().next().done === false) {
                // noop
            }

            try {
                const resp = await fetch('upload.php', { method: 'POST', body: fd });
                if (!resp.ok) return {};
                const data = await resp.json();
                return data.files || {};
            } catch (e) {
                console.error('Upload failed', e);
                return {};
            }
        }

        // Get database
        function getDatabase() {
            const raw = localStorage.getItem(DB_NAME);
            if (!raw) return { employees: [], users: [], systemLogs: [] };
            try {
                return JSON.parse(raw);
            } catch (e) {
                return { employees: [], users: [], systemLogs: [] };
            }
        }
        
        // Save database
        function saveDatabase(db) {
            localStorage.setItem(DB_NAME, JSON.stringify(db));
        }
        
        // Login function
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const loginType = document.getElementById('loginType').value;
            const messageDiv = document.getElementById('loginMessage');
            
            if (!username || !password) {
                messageDiv.textContent = "कृपया प्रयोगकर्ता नाम र पासवर्ड भर्नुहोस्";
                return;
            }
            
            const db = getDatabase();
            let user = null;
            
            if (loginType === 'superadmin') {
                if (password === SUPER_ADMIN_PASS) {
                    user = {username: 'superadmin', role: 'superadmin'};
                }
            } else {
                user = db.users.find(u => u.username === username && u.password === password);
            }
            
            if (user) {
                // Update last login
                if (user.username !== 'superadmin') {
                    const userIndex = db.users.findIndex(u => u.username === user.username);
                    if (userIndex !== -1) {
                        db.users[userIndex].lastLogin = new Date().toLocaleString('ne-NP');
                        saveDatabase(db);
                    }
                }
                
                // Store login info in session
                sessionStorage.setItem('loggedInUser', JSON.stringify(user));
                
                // Update UI
                document.getElementById('userInfo').innerHTML = 
                    `स्वागत छ, ${user.username} (${user.role})`;
                
                // Show admin link if user is admin or superadmin
                if (user.role === 'admin' || user.role === 'superadmin') {
                    document.getElementById('adminLink').style.display = 'block';
                } else {
                    document.getElementById('adminLink').style.display = 'none';
                }
                
                // Close modal
                closeLoginModal();
                messageDiv.textContent = "";
                
                // Add log
                addLog(`${user.username} लगइन गर्नुभयो`, "प्रवेश");
                
                alert(`स्वागत छ, ${user.username}! सफलतापूर्वक लगइन भयो।`);
            } else {
                messageDiv.textContent = "गलत प्रयोगकर्ता नाम वा पासवर्ड";
            }
        }
        
        // Show login modal
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }
        
        // Close login modal
        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginMessage').textContent = "";
        }
        
        // Add system log
        function addLog(action, type) {
            const db = getDatabase();
            const user = JSON.parse(sessionStorage.getItem('loggedInUser') || '{"username":"अतिथि"}');
            
            db.systemLogs.push({
                id: db.systemLogs.length + 1,
                username: user.username,
                action: action,
                type: type,
                timestamp: new Date().toLocaleString('ne-NP')
            });
            
            saveDatabase(db);
        }
        
        // Show section
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).style.display = 'block';
            
            // Add active class to clicked nav link
            event.target.classList.add('active');
            
            // Update data if needed
            if (sectionId === 'dashboard') {
                updateDashboard();
                loadRecentEmployees();
            } else if (sectionId === 'viewEmployees') {
                loadEmployees();
            } else if (sectionId === 'addEmployee') {
                // Prefill form with most recently added employee's data for convenience
                prefillRecentEmployee();
            } else if (sectionId === 'reports') {
                generateCharts();
            } else if (sectionId === 'adminPanel') {
                loadUsers();
            }
        }

        // Prefill the add-employee form using the most recent employee record
        function prefillRecentEmployee() {
            const db = getDatabase();
            const employees = db.employees || [];
            if (employees.length === 0) return;
            const recent = employees[employees.length - 1];

            // Populate fields
            document.getElementById('fullName').value = recent.fullName || '';
            document.getElementById('position').value = recent.position || '';
            document.getElementById('employeeType').value = recent.employeeType || '';
            document.getElementById('department').value = recent.department || '';
            document.getElementById('phone').value = recent.phone || '';
            document.getElementById('email').value = recent.email || '';
            document.getElementById('address').value = recent.address || '';
            document.getElementById('joinDate').value = recent.joinDate || '';
            document.getElementById('salary').value = recent.salary || '';
            document.getElementById('status').value = recent.status || 'सक्रिय';
            document.getElementById('remarks').value = recent.remarks || '';
            // new fields
            document.getElementById('nationalId').value = recent.nationalId || '';
            document.getElementById('emergencyContact').value = recent.emergencyContact || '';
            document.getElementById('photoURL').value = recent.photoURL || '';
            document.getElementById('extraInfo').value = recent.extraInfo || '';
        }
        
        // Update dashboard counts
        function updateDashboard() {
            const db = getDatabase();
            const employees = db.employees;
            
            document.getElementById('totalEmployees').textContent = employees.length;
            document.getElementById('nijamatiEmployees').textContent = 
                employees.filter(e => e.employeeType === 'निजामती').length;
            document.getElementById('localEmployees').textContent = 
                employees.filter(e => e.employeeType === 'स्थानीय तह').length;
            document.getElementById('contractEmployees').textContent = 
                employees.filter(e => e.employeeType === 'करार').length;
        }
        
        // Load recent employees
        function loadRecentEmployees() {
            const db = getDatabase();
            const recentEmployees = (db.employees || []).slice(-5).reverse();
            const tbody = document.getElementById('recentEmployeesTable');
            
            tbody.innerHTML = '';
            recentEmployees.forEach((emp, index) => {
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${emp.fullName}</td>
                        <td>${emp.position}</td>
                        <td>${emp.employeeType}</td>
                        <td>${emp.department || '-'}</td>
                        <td>${emp.phone || '-'}</td>
                        <td>${emp.joinDate || '-'}</td>
                        <td class="action-buttons">
                            <button onclick="viewEmployee(${emp.id})" class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="editEmployee(${emp.id})" class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // Load all employees
        function loadEmployees() {
            const db = getDatabase();
            const employees = db.employees;
            const tbody = document.getElementById('employeesTable');
            
            tbody.innerHTML = '';
            employees.forEach((emp, index) => {
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${emp.fullName}</td>
                        <td>${emp.position}</td>
                        <td>${emp.employeeType}</td>
                        <td>${emp.department || '-'}</td>
                        <td>${emp.phone}</td>
                        <td><span style="color: ${emp.status === 'सक्रिय' ? 'green' : emp.status === 'निष्क्रिय' ? 'red' : 'orange'}">${emp.status}</span></td>
                        <td class="action-buttons">
                            <button onclick="viewEmployee(${emp.id})" class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="editEmployee(${emp.id})" class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteEmployee(${emp.id})" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // Search employees
        function searchEmployees() {
            const searchTerm = document.getElementById('searchEmployee').value.toLowerCase();
            const rows = document.querySelectorAll('#employeesTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // Filter employees
        function filterEmployees() {
            const filterType = document.getElementById('filterType').value;
            const rows = document.querySelectorAll('#employeesTable tr');
            
            rows.forEach(row => {
                if (filterType === 'सबै') {
                    row.style.display = '';
                } else {
                    const typeCell = row.cells[3];
                    if (typeCell && typeCell.textContent === filterType) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }
        
        // Employee form submission (reads file inputs and stores DataURLs)
        document.getElementById('employeeForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const db = getDatabase();
            const employees = db.employees;

            // Validation: Check required fields
            const fullName = document.getElementById('fullName').value.trim();
            const position = document.getElementById('position').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const employeeType = document.getElementById('employeeType').value.trim();

            if (!fullName || !position || !phone || !employeeType) {
                alert('कृपया अनिवार्य फिल्डहरु (नाम, पद, फोन, कर्मचारी प्रकार) भर्नुहोस्।');
                return;
            }

            // Upload selected files to server (if any)
            const uploaded = await uploadSelectedFiles();
            const appointmentDocData = uploaded.appointmentDoc || null;
            const adjustmentDocData = uploaded.adjustmentDoc || null;
            const promotionDocData = uploaded.promotionDoc || null;
            const deputationDocData = uploaded.deputationDoc || null;
            const photoFileUrl = uploaded.photoFile || null;

            // Function to convert Gregorian to BS or return empty string
            const convertToBS = (gregorianDate) => {
                if (!gregorianDate) return '';
                const converted = bsConverter.gregorianToBs(gregorianDate);
                return converted || gregorianDate;
            };

            // Create new employee object with all fields
            const newEmployee = {
                id: 'EMP' + String(employees.length + 1).padStart(4, '0'),
                // Personal details
                employeeId: document.getElementById('employeeId')?.value || '',
                fullName: fullName,
                dateOfBirth: convertToBS(document.getElementById('dateOfBirth')?.value || ''),
                dateOfBirthGregorian: document.getElementById('dateOfBirth')?.value || '',
                fatherName: document.getElementById('fatherName')?.value || '',
                // Position details
                position: position,
                serviceLevel: document.getElementById('serviceLevel')?.value || '',
                serviceGroup: document.getElementById('serviceGroup')?.value || '',
                subGroup: document.getElementById('subGroup')?.value || '',
                employeeType: employeeType,
                department: document.getElementById('department')?.value || '',
                designation: document.getElementById('designation')?.value || '',
                // Education details
                qualification: document.getElementById('qualification')?.value || '',
                specialization: document.getElementById('specialization')?.value || '',
                experienceYears: parseInt(document.getElementById('experienceYears')?.value || 0),
                trainingCompleted: document.getElementById('trainingCompleted')?.value || 'होइन',
                // Contact details
                phone: phone,
                alternatePhone: document.getElementById('alternatePhone')?.value || '',
                email: document.getElementById('email')?.value || '',
                address: document.getElementById('address')?.value || '',
                emergencyContact: document.getElementById('emergencyContact')?.value || '',
                emergencyPhone: document.getElementById('emergencyPhone')?.value || '',
                // Appointment details
                joinDate: convertToBS(document.getElementById('joinDate')?.value || ''),
                joinDateGregorian: document.getElementById('joinDate')?.value || '',
                joiningOrder: document.getElementById('joiningOrder')?.value || '',
                salary: parseInt(document.getElementById('salary')?.value || 0),
                allowance: parseInt(document.getElementById('allowance')?.value || 0),
                status: document.getElementById('status')?.value || 'सक्रिय',
                serviceComplete: document.getElementById('serviceComplete')?.value || '',
                // Identity details
                nationalId: document.getElementById('nationalId')?.value || '',
                passportNumber: document.getElementById('passportNumber')?.value || '',
                panNumber: document.getElementById('panNumber')?.value || '',
                bankAccount: document.getElementById('bankAccount')?.value || '',
                // Photo details
                photoURL: photoFileUrl || (document.getElementById('photoURL')?.value || ''),
                photoFile: photoFileUrl || '',
                extraInfo: document.getElementById('extraInfo')?.value || '',
                remarks: document.getElementById('remarks')?.value || '',
                // Document dates and files (converted to BS)
                appointmentDocDate: convertToBS(document.getElementById('appointmentDocDate')?.value || ''),
                appointmentDocDateGregorian: document.getElementById('appointmentDocDate')?.value || '',
                appointmentDoc: appointmentDocData || '',
                adjustmentDate: convertToBS(document.getElementById('adjustmentDate')?.value || ''),
                adjustmentDateGregorian: document.getElementById('adjustmentDate')?.value || '',
                adjustmentDoc: adjustmentDocData || '',
                promotionDate: convertToBS(document.getElementById('promotionDate')?.value || ''),
                promotionDateGregorian: document.getElementById('promotionDate')?.value || '',
                promotionDoc: promotionDocData || '',
                deputationDate: convertToBS(document.getElementById('deputationDate')?.value || ''),
                deputationDateGregorian: document.getElementById('deputationDate')?.value || '',
                deputationDoc: deputationDocData || '',
                // System fields
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            // Add to database
            db.employees.push(newEmployee);
            saveDatabase(db);

            // Reset form
            resetForm();

            // Update UI
            updateDashboard();
            loadRecentEmployees();
            loadEmployees();

            // Add log
            const user = JSON.parse(sessionStorage.getItem('loggedInUser') || '{"username":"अतिथि"}');
            addLog(`${user.username} ले नयाँ कर्मचारी थप्नुभयो: ${newEmployee.fullName} (ID: ${newEmployee.id})`, "कर्मचारी थप्नु");

            alert(`✓ कर्मचारी ${newEmployee.fullName} (${newEmployee.id}) सफलतापूर्वक दर्ता गरियो!`);

            // Show View Employees section
            showSection('viewEmployees');
        });
        
        // Reset form
        function resetForm() {
            document.getElementById('employeeForm').reset();
        }
        
        // View employee details
        function viewEmployee(id) {
            const db = getDatabase();
            const employee = db.employees.find(e => e.id === id);
            
            if (employee) {
                document.getElementById('modalTitle').textContent = `कर्मचारी विवरण: ${employee.fullName}`;
                
                const details = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div><strong>पूरा नाम:</strong><br>${employee.fullName}</div>
                        <div><strong>पद/जागिर:</strong><br>${employee.position}</div>
                        <div><strong>कर्मचारी प्रकार:</strong><br>${employee.employeeType}</div>
                        <div><strong>शाखा/विभाग:</strong><br>${employee.department || '-'}</div>
                        <div><strong>सम्पर्क नम्बर:</strong><br>${employee.phone}</div>
                        <div><strong>इमेल:</strong><br>${employee.email || '-'}</div>
                        <div><strong>ठेगाना:</strong><br>${employee.address || '-'}</div>
                        <div><strong>नागरिकता/पहिचान:</strong><br>${employee.nationalId || '-'}</div>
                        <div><strong>नियुक्ति मिति:</strong><br>${employee.joinDate || '-'}</div>
                        <div><strong>तलब:</strong><br>${employee.salary ? 'रु. ' + employee.salary.toLocaleString('ne-NP') : '-'}</div>
                        <div><strong>आपतकालीन सम्पर्क:</strong><br>${employee.emergencyContact || '-'}</div>
                        <div><strong>अवस्था:</strong><br>${employee.status}</div>
                    </div>
                    ${employee.remarks || employee.extraInfo ? `<div style="margin-top: 15px;"><strong>टिप्पणी / अतिरिक्त:</strong><br>${(employee.remarks || '') + (employee.extraInfo ? '<br/>' + employee.extraInfo : '')}</div>` : ''}
                    ${employee.photoURL ? `<div style="margin-top:15px;text-align:center;"><img src="${employee.photoURL}" alt="photo" style="max-width:160px;border-radius:6px;border:1px solid #eee;"/></div>` : ''}
                    <div style="margin-top:12px;">
                            ${(function(){
                                function mk(label, date, url){
                                    if(!date && !url) return '';
                                    const isImage = url && /data:image|\.(png|jpe?g|gif)$/i.test(url);
                                    const isPDF = url && /\.(pdf)$/i.test(url);
                                    const view = url ? `<a href="${url}" target="_blank" style="margin-left:8px;">हेर्नुहोस्</a>` : '';
                                    const dl = url ? `<a href="${url}" download style="margin-left:6px;">डाउनलोड</a>` : '';
                                    const prev = isImage ? `<div style="margin-top:6px;"><img src="${url}" style="max-width:140px;border:1px solid #eee;border-radius:6px;"/></div>` : (isPDF ? `<div style="margin-top:6px;"><a href="${url}" target="_blank">PDF खोल्नुहोस्</a></div>` : '');
                                    return `<div><strong>${label}:</strong> ${date || '-'} ${view} ${dl} ${prev}</div>`;
                                }
                                return mk('नियुक्ति', employee.appointmentDocDate, employee.appointmentDoc)
                                    + mk('समायोजन', employee.adjustmentDate, employee.adjustmentDoc)
                                    + mk('बढुवा', employee.promotionDate, employee.promotionDoc)
                                    + mk('काज/समायोजन', employee.deputationDate, employee.deputationDoc);
                            })())
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button onclick="editEmployee(${employee.id})" class="btn btn-warning"><i class="fas fa-edit"></i> सम्पादन गर्नुहोस्</button>
                        <button onclick="printEmployee(${employee.id})" class="btn btn-success"><i class="fas fa-print"></i> प्रिन्ट गर्नुहोस्</button>
                    </div>
                `;
                
                document.getElementById('employeeDetails').innerHTML = details;
                document.getElementById('employeeModal').style.display = 'block';
                
                // Add log
                const user = JSON.parse(sessionStorage.getItem('loggedInUser') || '{"username":"अतिथि"}');
                addLog(`${user.username} ले कर्मचारी हेर्नुभयो: ${employee.fullName}`, "हेर्नु");

                // Removed automatic opening of biodata page to avoid popup; user can open from navigation if needed
            }
        }
        
        // Edit employee
        function editEmployee(id) {
            const db = getDatabase();
            const employee = db.employees.find(e => e.id === id);
            
            if (employee) {
                // Check if user is admin
                const user = JSON.parse(sessionStorage.getItem('loggedInUser') || '{}');
                if (user.role !== 'admin' && user.role !== 'superadmin') {
                    alert('तपाईंलाई कर्मचारी सम्पादन गर्ने अनुमति छैन। कृपया एडमिनसँग सम्पर्क गर्नुहोस्।');
                    return;
                }
                
                // Populate form with employee data
                document.getElementById('fullName').value = employee.fullName;
                document.getElementById('position').value = employee.position;
                document.getElementById('employeeType').value = employee.employeeType;
                document.getElementById('department').value = employee.department || '';
                document.getElementById('phone').value = employee.phone;
                document.getElementById('email').value = employee.email || '';
                document.getElementById('address').value = employee.address || '';
                document.getElementById('joinDate').value = employee.joinDate || '';
                document.getElementById('salary').value = employee.salary || '';
                document.getElementById('status').value = employee.status;
                document.getElementById('remarks').value = employee.remarks || '';
                // new fields
                if(document.getElementById('nationalId')) document.getElementById('nationalId').value = employee.nationalId || '';
                if(document.getElementById('emergencyContact')) document.getElementById('emergencyContact').value = employee.emergencyContact || '';
                if(document.getElementById('photoURL')) document.getElementById('photoURL').value = employee.photoURL || '';
                if(document.getElementById('extraInfo')) document.getElementById('extraInfo').value = employee.extraInfo || '';
                
                // Change form to edit mode
                const form = document.getElementById('employeeForm');
                form.onsubmit = async function(e) {
                    e.preventDefault();

                    // Upload any newly selected files to server (if user uploaded new docs)
                    const uploaded = await uploadSelectedFiles();
                    const appointmentDocData = uploaded.appointmentDoc || null;
                    const adjustmentDocData = uploaded.adjustmentDoc || null;
                    const promotionDocData = uploaded.promotionDoc || null;
                    const deputationDocData = uploaded.deputationDoc || null;
                    const photoFileUrl = uploaded.photoFile || null;

                    // Update employee
                    employee.fullName = document.getElementById('fullName').value;
                    employee.position = document.getElementById('position').value;
                    employee.employeeType = document.getElementById('employeeType').value;
                    employee.department = document.getElementById('department').value;
                    employee.phone = document.getElementById('phone').value;
                    employee.email = document.getElementById('email').value;
                    employee.address = document.getElementById('address').value;
                    const rawJoinDateEdit = document.getElementById('joinDate').value;
                    employee.joinDate = rawJoinDateEdit ? (bsConverter.gregorianToBs(rawJoinDateEdit) || rawJoinDateEdit) : (employee.joinDate || '');
                    employee.joinDateGregorian = rawJoinDateEdit || (employee.joinDateGregorian || '');
                    employee.nationalId = document.getElementById('nationalId') ? document.getElementById('nationalId').value : '';
                    employee.emergencyContact = document.getElementById('emergencyContact') ? document.getElementById('emergencyContact').value : '';
                    employee.photoURL = document.getElementById('photoURL') ? document.getElementById('photoURL').value : '';
                    employee.extraInfo = document.getElementById('extraInfo') ? document.getElementById('extraInfo').value : '';
                    employee.salary = parseInt(document.getElementById('salary').value) || 0;
                    employee.status = document.getElementById('status').value;
                    employee.remarks = document.getElementById('remarks').value;

                    // update document dates and files only if provided
                    if (document.getElementById('appointmentDocDate')) {
                        const v = document.getElementById('appointmentDocDate').value || '';
                        if (v) { employee.appointmentDocDate = bsConverter.gregorianToBs(v) || v; employee.appointmentDocDateGregorian = v; }
                    }
                    if (appointmentDocData) employee.appointmentDoc = appointmentDocData;
                    if (document.getElementById('adjustmentDate')) {
                        const v = document.getElementById('adjustmentDate').value || '';
                        if (v) { employee.adjustmentDate = bsConverter.gregorianToBs(v) || v; employee.adjustmentDateGregorian = v; }
                    }
                    if (adjustmentDocData) employee.adjustmentDoc = adjustmentDocData;
                    if (document.getElementById('promotionDate')) {
                        const v = document.getElementById('promotionDate').value || '';
                        if (v) { employee.promotionDate = bsConverter.gregorianToBs(v) || v; employee.promotionDateGregorian = v; }
                    }
                    if (promotionDocData) employee.promotionDoc = promotionDocData;
                    if (document.getElementById('deputationDate')) {
                        const v = document.getElementById('deputationDate').value || '';
                        if (v) { employee.deputationDate = bsConverter.gregorianToBs(v) || v; employee.deputationDateGregorian = v; }
                    }
                    if (deputationDocData) employee.deputationDoc = deputationDocData;

                    if (photoFileUrl) employee.photoURL = photoFileUrl;

                    employee.updatedAt = new Date().toISOString();

                    saveDatabase(db);

                    // Reset form
                    resetForm();
                    form.onsubmit = null; // Reset to default submit

                    // Update UI
                    updateDashboard();
                    loadEmployees();
                    loadRecentEmployees();

                    // Close modal if open
                    closeEmployeeModal();

                    // Add log
                    addLog(`${user.username} ले कर्मचारी सम्पादन गर्नुभयो: ${employee.fullName}`, "सम्पादन");

                    alert(`कर्मचारी ${employee.fullName} सफलतापूर्वक अद्यावधिक गरियो!`);

                    // Switch to view employees
                    showSection('viewEmployees');
                };
                
                // Change button text
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> अद्यावधिक गर्नुहोस्';
                submitBtn.className = 'btn btn-success';
                
                // Show add employee section
                showSection('addEmployee');
                
                // Add log
                addLog(`${user.username} ले कर्मचारी सम्पादन गर्न खोल्नुभयो: ${employee.fullName}`, "सम्पादन");
            }
        }
        
        // Delete employee
        function deleteEmployee(id) {
            const user = JSON.parse(sessionStorage.getItem('loggedInUser') || '{}');
            if (user.role !== 'admin' && user.role !== 'superadmin') {
                alert('तपाईंलाई कर्मचारी हटाउने अनुमति छैन। कृपया एडमिनसँग सम्पर्क गर्नुहोस्।');
                return;
            }
            
            if (confirm('के तपाईं यो कर्मचारी रेकर्ड मेटाउन निश्चित हुनुहुन्छ?')) {
                const db = getDatabase();
                const employeeIndex = db.employees.findIndex(e => e.id === id);
                
                if (employeeIndex !== -1) {
                    const employeeName = db.employees[employeeIndex].fullName;
                    db.employees.splice(employeeIndex, 1);
                    saveDatabase(db);
                    
                    updateDashboard();
                    loadEmployees();
                    loadRecentEmployees();
                    
                    // Add log
                    addLog(`${user.username} ले कर्मचारी हटाउनुभयो: ${employeeName}`, "हटाउनु");
                    
                    alert('कर्मचारी रेकर्ड सफलतापूर्वक मेटाइयो!');
                }
            }
        }
        
        // Close employee modal
        function closeEmployeeModal() {
            document.getElementById('employeeModal').style.display = 'none';
        }
        
        // Generate charts
        function generateCharts() {
            const db = getDatabase();
            const employees = db.employees;
            
            // Employee type chart
            const typeCounts = {
                'निजामती': employees.filter(e => e.employeeType === 'निजामती').length,
                'स्थानीय तह': employees.filter(e => e.employeeType === 'स्थानीय तह').length,
                'करार': employees.filter(e => e.employeeType === 'करार').length,
                'अन्य': employees.filter(e => e.employeeType === 'अन्य').length
            };
            
            let typeChartHTML = '';
            for (const [type, count] of Object.entries(typeCounts)) {
                const width = count > 0 ? (count / employees.length) * 100 : 0;
                typeChartHTML += `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>${type}</span>
                            <span>${count}</span>
                        </div>
                        <div style="background: #eee; height: 10px; border-radius: 5px; margin-top: 5px;">
                            <div style="background: #3498db; width: ${width}%; height: 100%; border-radius: 5px;"></div>
                        </div>
                    </div>
                `;
            }
            document.getElementById('typeChart').innerHTML = typeChartHTML;
            
            // Status chart
            const statusCounts = {
                'सक्रिय': employees.filter(e => e.status === 'सक्रिय').length,
                'निष्क्रिय': employees.filter(e => e.status === 'निष्क्रिय').length,
                'अवकाश': employees.filter(e => e.status === 'अवकाश').length
            };
            
            let statusChartHTML = '';
            for (const [status, count] of Object.entries(statusCounts)) {
                const color = status === 'सक्रिय' ? '#27ae60' : status === 'निष्क्रिय' ? '#e74c3c' : '#f39c12';
                const width = count > 0 ? (count / employees.length) * 100 : 0;
                statusChartHTML += `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>${status}</span>
                            <span>${count}</span>
                        </div>
                        <div style="background: #eee; height: 10px; border-radius: 5px; margin-top: 5px;">
                            <div style="background: ${color}; width: ${width}%; height: 100%; border-radius: 5px;"></div>
                        </div>
                    </div>
                `;
            }
            document.getElementById('statusChart').innerHTML = statusChartHTML;
            
            // Department chart (simplified)
            document.getElementById('departmentChart').innerHTML = `
                <div style="text-align: center; padding-top: 50px;">
                    <i class="fas fa-building" style="font-size: 48px; color: #9b59b6;"></i>
                    <p style="margin-top: 15px;">${new Set(employees.map(e => e.department)).size} विभिन्न शाखाहरू</p>
                    <button onclick="generateReport('department')" class="btn btn-primary" style="margin-top: 10px;">
                        <i class="fas fa-chart-bar"></i> विस्तृत हेर्नुहोस्
                    </button>
                </div>
            `;
        }
        
        // Generate report
        function generateReport(type) {
            const db = getDatabase();
            const employees = db.employees;
            
            let reportHTML = '<h3>रिपोर्ट विवरण</h3>';
            
            if (type === 'type') {
                reportHTML += '<p>कर्मचारी प्रकार अनुसारको वितरण</p>';
                // Add chart data
            }
            
            document.getElementById('reportTitle').textContent = 'रिपोर्ट: ' + type;
            document.getElementById('reportContent').innerHTML = reportHTML;
            document.getElementById('reportResult').style.display = 'block';
            
            // Add log
            const user = JSON.parse(sessionStorage.getItem('loggedInUser') || '{"username":"अतिथि"}');
            addLog(`${user.username} ले रिपोर्ट जेनरेट गर्नुभयो: ${type}`, "रिपोर्ट");
        }
        
        // Generate detailed report
        function generateDetailedReport() {
            const reportType = document.getElementById('reportType').value;
            const reportFormat = document.getElementById('reportFormat').value;
            
            alert(`${reportType} रिपोर्ट ${reportFormat} फर्म्याटमा तयार गरिँदैछ...`);
            
            // In a real application, this would generate and download the report
            // For now, we'll just show a message
            document.getElementById('reportTitle').textContent = `${reportType} रिपोर्ट`;
            document.getElementById('reportContent').innerHTML = `
                <p>यो रिपोर्ट ${reportFormat} फर्म्याटमा तयार भएको छ।</p>
                <p>वास्तविक अनुप्रयोगमा, यहाँ रिपोर्टको विस्तृत विवरण देखिनेछ वा फाइल डाउनलोड हुनेछ।</p>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success"><i class="fas fa-download"></i> रिपोर्ट डाउनलोड गर्नुहोस्</button>
                </div>
            `;
            document.getElementById('reportResult').style.display = 'block';
            
            // Add log
            const user = JSON.parse(sessionStorage.getItem('loggedInUser') || '{"username":"अतिथि"}');
            addLog(`${user.username} ले विस्तृत रिपोर्ट जेनरेट गर्नुभयो: ${reportType}`, "रिपोर्ट");
        }
        
        // Print employee report
        function printEmployeeReport() {
            window.print();
        }
        
        // Export to Excel
        function exportToExcel() {
            alert('एक्सेलमा निर्यात गरिँदैछ...');
            // In a real application, this would export data to Excel
            // Add log
            const user = JSON.parse(sessionStorage.getItem('loggedInUser') || '{"username":"अतिथि"}');
            addLog(`${user.username} ले डाटा एक्सेलमा निर्यात गर्नुभयो`, "निर्यात");
        }
        
        // Print individual employee
        function printEmployee(id) {
            // This would open a print dialog for the employee
            alert('कर्मचारी प्रिन्ट गरिँदैछ...');
        }
        
        // Admin functions
        function showAdminSection(sectionId) {
            // Hide all admin sections
            document.querySelectorAll('#adminPanel > .form-container').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionId + 'Section').style.display = 'block';
        }
        
        // Load users for admin
        function loadUsers() {
            const db = getDatabase();
            const users = db.users;
            const tbody = document.getElementById('usersTable');
            
            tbody.innerHTML = '';
            users.forEach((user, index) => {
                const row = `
                    <tr>
                        <td>${user.username}</td>
                        <td>${user.role}</td>
                        <td>${user.lastLogin || '-'}</td>
                        <td>
                            ${user.role !== 'superadmin' ? `
                                <button onclick="editUser('${user.username}')" class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteUser('${user.username}')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : '<span style="color: #7f8c8d;">सम्पादन गर्नुहुदैन</span>'}
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // Add new user
        function addNewUser() {
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;
            const role = document.getElementById('userRole').value;
            
            if (!username || !password) {
                alert('कृपया प्रयोगकर्ता नाम र पासवर्ड भर्नुहोस्');
                return;
            }
            
            const db = getDatabase();
            
            // Check if username already exists
            if (db.users.some(u => u.username === username)) {
                alert('यो प्रयोगकर्ता नाम पहिले नै रेजिष्टर्ड छ');
                return;
            }
            
            // Add new user
            db.users.push({
                username: username,
                password: password,
                role: role,
                lastLogin: ''
            });
            
            saveDatabase(db);
            loadUsers();
            
            // Clear form
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            
            // Add log
            const user = JSON.parse(sessionStorage.getItem('loggedInUser') || '{"username":"अतिथि"}');
            addLog(`${user.username} ले नयाँ प्रयोगकर्ता थप्नुभयो: ${username}`, "प्रयोगकर्ता व्यवस्थापन");
            
            alert(`प्रयोगकर्ता ${username} सफलतापूर्वक थपियो!`);
        }
        
        // Edit user
        function editUser(username) {
            // Implementation for editing user
            alert(`प्रयोगकर्ता ${username} सम्पादन गर्ने सुविधा विकास अन्तर्गत छ`);
        }
        
        // Delete user
        function deleteUser(username) {
            if (confirm(`के तपाईं प्रयोगकर्ता ${username} लाई मेटाउन निश्चित हुनुहुन्छ?`)) {
                const db = getDatabase();
                const userIndex = db.users.findIndex(u => u.username === username);
                
                if (userIndex !== -1) {
                    db.users.splice(userIndex, 1);
                    saveDatabase(db);
                    loadUsers();
                    
                    // Add log
                    const user = JSON.parse(sessionStorage.getItem('loggedInUser') || '{"username":"अतिथि"}');
                    addLog(`${user.username} ले प्रयोगकर्ता हटाउनुभयो: ${username}`, "प्रयोगकर्ता व्यवस्थापन");
                    
                    alert(`प्रयोगकर्ता ${username} सफलतापूर्वक मेटाइयो!`);
                }
            }
        }

        // ========== Sample Data Function ==========
        // Sample Nepali names and data
        const sampleNepaliNames = [
            "राज कुमार शर्मा", "सीमा राई", "राजेन्द्र कार्की", "प्रज्ञा भट्टराई", "संजय पाण्डे",
            "नीता गुप्ता", "विक्रम सिंह", "उषा शर्मा", "अरुण थापा", "आशा गौतम",
            "राम कुमार घिमिरे", "सुनिता मल्ल", "संजीव नेपाली", "कंचन खड्का", "दिपक शर्मा",
            "मीरा पोखरेल", "नरेश कुमार", "रिता गिरी", "संगीता चौधरी", "अजय सिंह",
            "प्रीति वर्मा", "महेश पाण्डे", "अंजु शर्मा", "विजय कुमार", "पार्वती गुप्ता",
            "हरेन्द्र यादव", "संध्या सिंह", "प्रमोद कुमार", "साधना शर्मा", "अनिल पाठक",
            "स्वप्ना राई", "कमल कार्की", "निशा पोखरेल", "राजीव सिंह", "गीता शर्मा",
            "संजय मैनाली", "शीला गौतम", "अजय नेपाली", "पूर्णा भट्टराई", "संतोष पाण्डे",
            "मंजु खड्का", "विक्रम शर्मा", "पारू गिरी", "राजेश कार्की", "नलिनी वर्मा",
            "रोहित सिंह", "प्रिया शर्मा", "मोहन पाठक", "संजना पोखरेल", "संदीप नेपाली",
            "गीतांजलि राई", "राव कुमार", "सीता गुप्ता", "प्रभाकर शर्मा", "दिपिका सिंह",
            "सुमित्रा भट्टराई", "आदित्य कार्की", "अंजलि मल्ल", "सुशील पाण्डे", "गंगा नेपाली"
        ];

        const positions = [
            "प्रमुख", "सह-प्रमुख", "सचिव", "प्रशासन अधिकृत", "लेखाकर्मचारी",
            "शिक्षक", "चिकित्सक", "नर्स", "अभियन्ता", "स्वास्थ्य कार्यकर्ता",
            "कृषि अधिकृत", "पर्यावरण अधिकृत", "सामाजिक विकास अधिकृत", "महिला विकास अधिकृत", "यतिम गृह संचालक"
        ];

        const departments = [
            "प्रशासन", "वित्त", "शिक्षा", "स्वास्थ्य", "कृषि",
            "सामाजिक विकास", "भौतिक पूर्वाधार", "विद्युत", "जल आपूर्ति", "सचिवालय"
        ];

        const empTypes = ["निजामती", "स्थानीय तह", "करार"];
        const statuses = ["सक्रिय", "निष्क्रिय", "अवकाश"];

        // Generate sample employees
        function generateSampleEmployees() {
            const db = getDatabase();
            const startYear = 2055;
            
            for (let i = 0; i < 60; i++) {
                const randomName = sampleNepaliNames[Math.floor(Math.random() * sampleNepaliNames.length)];
                const randomPos = positions[Math.floor(Math.random() * positions.length)];
                const randomDept = departments[Math.floor(Math.random() * departments.length)];
                const randomType = empTypes[Math.floor(Math.random() * empTypes.length)];
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                
                // Generate random join date (Gregorian)
                const year = startYear + Math.floor(i / 12);
                const month = (i % 12) + 1;
                const joinDateGregorian = `${year - 10 + Math.floor(Math.random() * 5)}-${String(month).padStart(2, '0')}-${String(15 + Math.floor(Math.random() * 10)).padStart(2, '0')}`;
                const joinDateBS = bsConverter.gregorianToBs(joinDateGregorian) || joinDateGregorian;
                
                const employee = {
                    id: 'EMP' + String(i + 1).padStart(4, '0'),
                    fullName: randomName,
                    position: randomPos,
                    employeeType: randomType,
                    department: randomDept,
                    phone: '98' + String(Math.floor(Math.random() * 100000000)).padStart(8, '0'),
                    email: randomName.replace(/\s+/g, '.').toLowerCase() + '@example.com',
                    address: 'खडक नगरपालिका, वार्ड ' + (Math.floor(Math.random() * 10) + 1),
                    joinDate: joinDateBS,
                    joinDateGregorian: joinDateGregorian,
                    nationalId: String(Math.floor(Math.random() * 1000000000)).padStart(10, '0'),
                    emergencyContact: 'अभिभावक: ' + String(Math.floor(Math.random() * 9000000000) + 1000000000),
                    photoURL: 'https://via.placeholder.com/150?text=' + encodeURIComponent(randomName.split(' ')[0]),
                    photoFile: '',
                    extraInfo: 'Sample data generated for testing',
                    appointmentDocDate: joinDateBS,
                    appointmentDoc: '',
                    adjustmentDate: '',
                    adjustmentDoc: '',
                    promotionDate: '',
                    promotionDoc: '',
                    deputationDate: '',
                    deputationDoc: '',
                    salary: Math.floor(Math.random() * 50000) + 20000,
                    status: randomStatus,
                    remarks: 'परीक्षणको लागि नमूना डाटा'
                };
                
                db.employees.push(employee);
            }
            
            saveDatabase(db);
            alert('६० जना कर्मचारीको नमूना डाटा सफलतापूर्वक थपिएको छ!');
            location.reload();
        }

        // Clear all employees (with confirmation)
        function clearAllEmployees() {
            if (confirm('के तपाईं सबै कर्मचारीको डाटा मेटाउन निश्चित हुनुहुन्छ? यो क्रिया उल्टाउन सकिँदैन।')) {
                const db = getDatabase();
                db.employees = [];
                saveDatabase(db);
                alert('सबै कर्मचारीको डाटा मेटाइयो!');
                location.reload();
            }
        }

        // Update statistics
        function updateStatistics() {
            const db = getDatabase();
            document.getElementById('totalEmployeeCount').textContent = db.employees.length;
            document.getElementById('totalDarwandiCount').textContent = db.darwandi.length;
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeDatabase();
            
            // Check if user is already logged in
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            if (loggedInUser) {
                const user = JSON.parse(loggedInUser);
                document.getElementById('userInfo').innerHTML = 
                    `स्वागत छ, ${user.username} (${user.role})`;
                
                if (user.role === 'admin' || user.role === 'superadmin') {
                    document.getElementById('adminLink').style.display = 'block';
                }
            }
        });
    </script>
</body>
</html>